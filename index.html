<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1.0" >
    <title>VƒÅtƒÅvarana ‚Äì Weather Assistant</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: 'Segoe UI', sans-serif;
        background-color: #0f172a;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #e2e8f0;
      }
      .chat-container {
        width: 100%;
        max-width: 600px;
        height: 80vh;
        display: flex;
        flex-direction: column;
        background-color: #1e293b;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
      }
      .title-bar {
        background-color: #0ea5e9;
        padding: 15px;
        color: white;
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        letter-spacing: 1px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .title-bar img {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        margin-right: 10px;
      }
      .messages {
        flex-grow: 1;
        padding: 20px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
      }
      .message {
        padding: 12px 18px;
        border-radius: 18px;
        margin-bottom: 12px;
        max-width: 85%;
        font-size: 16px;
        line-height: 1.5;
        white-space: pre-wrap;
        display: flex;
        align-items: center;
      }
      .message.user {
        align-self: flex-end;
        background-color: #3b82f6;
        color: white;
      }
      .message.bot {
        align-self: flex-start;
        background-color: #334155;
        color: #f1f5f9;
      }
      .message.bot img {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        margin-right: 10px;
      }
      .input-area {
        display: flex;
        border-top: 1px solid #334155;
        padding: 10px;
        background-color: #1e293b;
      }
      input {
        flex-grow: 1;
        padding: 10px 14px;
        border-radius: 20px;
        border: 1px solid #475569;
        font-size: 16px;
        background-color: #0f172a;
        color: white;
        outline: none;
      }
      button {
        background-color: #0ea5e9;
        border: none;
        color: white;
        padding: 10px 18px;
        font-size: 16px;
        border-radius: 20px;
        cursor: pointer;
        margin-left: 8px;
      }
      button:hover {
        background-color: #0284c7;
      }
    </style>
  <script defer data-domain="vatavaran.tiiny.site" src="https://analytics.tiiny.site/js/plausible.js"></script><script type="text/javascript" src="https://tiiny.host/ad-script.js"></script><script defer data-domain="vatavaran.tiiny.site" src="https://analytics.tiiny.site/js/plausible.js"></script><script type="text/javascript" src="https://tiiny.host/ad-script.js"></script><meta property="og:url" content="https://vatavaran.tiiny.site/" data-id="th-modified" ><meta property="og:type" content="website" data-id="th-modified" ><script defer data-domain="vatavaran.tiiny.site" src="https://analytics.tiiny.site/js/plausible.js"></script><script type="text/javascript" src="https://tiiny.host/ad-script.js"></script><script defer data-domain="vatavaran.tiiny.site" src="https://analytics.tiiny.site/js/plausible.js"></script><script type="text/javascript" src="https://tiiny.host/ad-script.js"></script><script defer data-domain="vatavaran.tiiny.site" src="https://analytics.tiiny.site/js/plausible.js"></script><script type="text/javascript" src="https://tiiny.host/ad-script.js"></script></head>
  <body>
    <div class="chat-container">
      <div class="title-bar">
        <img src="https://i.ibb.co/chCH3r8L/Whimsical-Folk-Inspired-Weather-App-Logo-1.png" alt="Bot Profile Picture" >
        VƒÅtƒÅvarana ‚Äì Weather Assistant
      </div>
      <div class="messages" id="messages"></div>
      <div class="input-area">
        <input type="text" id="user-input" placeholder="Ask about the weather..." >
        <button onclick="handleUserInput()">Send</button>
      </div>
    </div>

    <script>
      const apiKey = '09c246d9d7484b679ea174521250707'; // Your WeatherAPI key
      const messagesContainer = document.getElementById("messages");
      const input = document.getElementById("user-input");

      // Function to create messages in the chat
      function createMessage(content, sender = "bot") {
        const div = document.createElement("div");
        div.className = `message ${sender}`;
        if (sender === "bot") {
          div.innerHTML = `<img src="https://i.ibb.co/chCH3r8L/Whimsical-Folk-Inspired-Weather-App-Logo-1.png" alt="bot-img" /> ${content}`; // Add profile picture
        } else {
          div.textContent = content;
        }
        messagesContainer.appendChild(div);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      
      window.onload = () => {
  setTimeout(() => {
    createMessage("üëã Hi! I'm VƒÅtƒÅvarana ‚Äì your Weather Assistant. How can I assist you today?");
  }, 300);
  setTimeout(() => {
    createMessage("You can ask me about the weather in any city.");
  }, 1000);
  setTimeout(() => {
    createMessage("If you want any help, just type [help] anytime.");
  }, 1700);
};

        function handleUserInput() {
        const text = input.value.trim();
        if (!text) return;

        createMessage(text, "user");
        input.value = "";

        const lower = text.toLowerCase();
        if (/^(hi|hai|hello|good morning|good evening|good afternoon)$/.test(lower)) {
            createMessage("üëã Hello! I'm VƒÅtƒÅvarana, your weather assistant. Ask me about any city's weather forecast üå¶Ô∏è");
            return; // Stop here, no weather request
        }

        // ‚úÖ If user asks for help, show help and stop further execution
        if (lower === "help") {
            createMessage("üÜò Here are some things I can do:\n\n‚Ä¢ Provide current weather for any city.\n‚Ä¢ Show forecasts for the next few days.\n‚Ä¢ Give wind speed, humidity, AQI, and chance of rain.\n\nüí¨ Example questions:\n‚Ä¢ 'What's the weather in Delhi?'\n‚Ä¢ 'What‚Äôs the forecast for tomorrow in Mumbai?'\n‚Ä¢ 'Will it rain in Bangalore today?'\n‚Ä¢ 'Kolkata' (just a city name works too!)");
            return; // ‚õî Stop further processing
        }

        // ‚úÖ Allow 'yes' or 'exit' quick commands
        if (lower === "yes") {
            createMessage("Great! Ask me about another city's weather.", "bot");
            return;
        } else if (lower === "exit") {
            createMessage("Goodbye! Stay safe and have a great day! ‚òÄÔ∏è", "bot");
            return;
        }
        setTimeout(() => {
            const { city, dataRequested, daysRequested } = analyzeUserRequest(text || input.value.trim());
            fetchWeatherData(city, dataRequested, daysRequested);
        }, 600);
    }


        function analyzeUserRequest(inputText) {
        const lower = inputText.toLowerCase();
        let city = extractCity(lower);
        let dataRequested = [];

        const wantsForecast = /forecast|tomorrow|weekend|next\s*\d+\s*days?|hourly/.test(lower);
        const forecastDaysMatch = lower.match(/next\s*(\d+)\s*days?/);
        const daysRequested = forecastDaysMatch
            ? parseInt(forecastDaysMatch[1])
            : lower.includes("weekend")
            ? 3
            : lower.includes("tomorrow") || lower.includes("hourly")
            ? 2
            : 1;

        if (/help/.test(lower)) {
            createMessage("Here are some things I can do:\n- Provide current weather for any city.\n- Show forecasts for the next few days.\n- Give details like wind speed, humidity, and the chance of rain.\n\nYou can ask me like this:\n- 'What's the weather in Delhi?'\n- 'What‚Äôs the forecast for tomorrow in Mumbai?'\n- 'Will it rain in Bangalore today?'");
        }

        if (/wind/.test(lower)) dataRequested.push("wind");
        if (/air quality|aqi/.test(lower)) dataRequested.push("air quality");
        if (/humidity/.test(lower)) dataRequested.push("humidity");
        if (/uv/.test(lower)) dataRequested.push("uv index");
        if (/chance of rain|will it rain/.test(lower)) dataRequested.push("chance of rain");
        if (/hourly/.test(lower)) dataRequested.push("hourly forecast");
        if (wantsForecast) dataRequested.push("forecast");

        // ‚úÖ Always show full weather details if city or "weather" is mentioned
        if (city || /weather/.test(lower)) {
            dataRequested = [
            "weather",         // condition
            "temperature",     // current + feels like
            "wind",
            "humidity",
            "air quality",
            "forecast"
            ];
        }

        return { city, dataRequested, daysRequested };
}


      function extractCity(text) {
        const prepositionMatch = text.match(/(?:in|for|at)\s+([a-zA-Z\s]+)$/);
        if (prepositionMatch) return prepositionMatch[1].trim();
        const singleWordMatch = text.match(/^[a-zA-Z\s]+$/);
        return singleWordMatch ? singleWordMatch[0].trim() : '';
}

      function fetchWeatherData(city, dataRequested, daysRequested = 1) {
        if (!city) {
          createMessage("Please provide a valid city name.", "bot");
          return;
        }

        const wantsForecast = dataRequested.includes("forecast") || dataRequested.includes("hourly forecast") || dataRequested.includes("chance of rain");

        const endpoint = `https://api.weatherapi.com/v1/forecast.json?key=${apiKey}&q=${city}&days=${daysRequested}&aqi=yes`;

        fetch(endpoint)
          .then((response) => response.json())
          .then((data) => {
            if (data.error) {
                createMessage("Hmm, I couldn't find that city. üåç", "bot");
                setTimeout(() => {
                    createMessage("üëâ Please enter a nearby major city like Delhi, Mumbai, or Bangalore.", "bot");
                }, 700);
                return;
            }

            const { current, location, forecast } = data;
            let message = `Weather in ${location.name}, ${location.region}:`;

            // Display current temperature and feels like temp
            if (dataRequested.includes("temperature")) {
              message += `\nüå°Ô∏è Temp: ${current.temp_c}¬∞C (Feels like: ${current.feelslike_c}¬∞C)`;
            }

            // Display Air Quality and Humidity on a new line
            if (dataRequested.includes("air quality") || dataRequested.includes("humidity")) {
              message += `\nüí® AQI: ${current.air_quality.pm10 || "Not available"}`;
              message += `\nüíß Humidity: ${current.humidity}%`;
            }

            // Display highest and lowest temperatures (from the forecast)
            if (forecast && forecast.forecastday && forecast.forecastday[0]) {
              const day = forecast.forecastday[0].day;
              message += `\nüìä High: ${day.maxtemp_c}¬∞C, Low: ${day.mintemp_c}¬∞C`;
            }

            if (dataRequested.includes("wind")) {
              message += `\nüå¨Ô∏è Wind: ${current.wind_kph} km/h, ${current.wind_dir}`;
            }

            if (dataRequested.includes("weather")) {
              message += `\n‚òÅÔ∏è Condition: ${current.condition.text}`;
            }

            createMessage(message, "bot");

            // üîπ Chance of Rain
            if (dataRequested.includes("chance of rain") && forecast) {
              let rainMsg = "üåßÔ∏è Chance of Rain:";
              forecast.forecastday.forEach((day) => {
                rainMsg += `\nüìÖ ${day.date}: ${day.day.daily_chance_of_rain}%`;
              });
              createMessage(rainMsg, "bot");
            }

            // üîπ Hourly Forecast
            if (dataRequested.includes("hourly forecast") && forecast) {
              const todayHours = forecast.forecastday[0].hour;
              let hourlyMsg = "üïê Hourly Forecast (Today):";
              for (let i = 0; i < todayHours.length; i += 3) {
                const hour = todayHours[i];
                hourlyMsg += `\n${hour.time.split(" ")[1]}: ${hour.temp_c}¬∞C, ${hour.condition.text}, üíß ${hour.chance_of_rain}%`;
              }
              createMessage(hourlyMsg, "bot");
            }

            // üîπ Daily Forecast
            if (dataRequested.includes("forecast") && forecast) {
              const forecastDays = forecast.forecastday;
              let forecastMsg = `üìÖ ${forecastDays.length}-Day Forecast:`;
              forecastDays.forEach((day) => {
                forecastMsg += `\n\nüìÜ ${day.date}\n- üå§ ${day.day.condition.text}\n- üå° High: ${day.day.maxtemp_c}¬∞C, Low: ${day.day.mintemp_c}¬∞C\n- ‚òî Chance of Rain: ${day.day.daily_chance_of_rain}%`;
              });
              createMessage(forecastMsg, "bot");
            }

            // Ask if user wants to continue or exit
            setTimeout(() => {
              createMessage("Would you like to continue? Type 'yes' to ask another question or 'exit' to leave.", "bot");
            }, 600);
          })
          .catch((err) => {
            createMessage("There seems to be an issue with our connection. Please try again later.", "bot");
            console.error("Fetch error:", err);
          });
      }

      document.getElementById("user-input").addEventListener("keydown", function (e) {
        if (e.key === "Enter") handleUserInput();
      });
    </script>
  </body>
</html>
